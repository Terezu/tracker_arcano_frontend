<div class="stats-page-wrapper" [ngClass]="themeService.isTemaClaro() ? 'tema-claro' : 'tema-escuro'">
  
  <div class="stats-container" *ngIf="stats">
    <button routerLink="/" class="btn-back">‚Üê Voltar</button>

    <h2 class="stats-title">{{ stats.deckName || 'Estat√≠sticas' }}</h2>

    <div class="matchups-container">
      <h3>Matchups (Confrontos)</h3>
      
      <div class="matchups-grid">
        <div *ngFor="let match of stats.matchups" 
             (click)="selecionarOponente(match.nomeArquetipo)"
             class="match-card"
             [ngClass]="{'active': oponenteSelecionado === match.nomeArquetipo}">
          <strong>{{ match.nomeArquetipo }}</strong>
          <div class="match-details">
            WR: {{ match.matchWinRate | number:'1.0-1' }}% ({{ match.matchWins }}V - {{ match.matchLosses }}D)
          </div>
        </div>
      </div>

      <div class="novo-oponente-form">
        <input type="text" [(ngModel)]="novoOponente" placeholder="Novo Deck Oponente (Ex: Kuldotha Red)" class="input-tema">
        <button (click)="adicionarOponente()" class="btn-primary">
          Selecionar Novo
        </button>
      </div>
    </div>

    <div class="actions" *ngIf="oponenteSelecionado">
      <h3>Registrar Partida vs {{ oponenteSelecionado }}</h3>
      
      <div class="group-win">
        <span class="label">Vit√≥ria</span>
        <button (click)="registrarResultado(2, 0)" [disabled]="isSaving" class="btn-score win">2-0</button>
        <button (click)="registrarResultado(2, 1)" [disabled]="isSaving" class="btn-score win">2-1</button>
      </div>

      <div class="group-loss">
        <span class="label">Derrota</span>
        <button (click)="registrarResultado(1, 2)" [disabled]="isSaving" class="btn-score loss">1-2</button>
        <button (click)="registrarResultado(0, 2)" [disabled]="isSaving" class="btn-score loss">0-2</button>
      </div>
    </div>

    <div class="stats-header">
      <h3 class="destaque-cor">
        {{ visualizandoGeral ? 'Estat√≠sticas Gerais do Deck' : 'Estat√≠sticas vs ' + oponenteSelecionado }}
      </h3>
      
      <button *ngIf="oponenteSelecionado" (click)="alternarVisualizacaoStats()" class="btn-outline">
        {{ visualizandoGeral ? 'Ver Estat√≠sticas da Match' : 'Ver Estat√≠sticas Totais do Deck' }}
      </button>
    </div>

    <div class="cards-grid">
      <div class="stat-card highlight">
        <h3>Match Win Rate</h3>
        <p class="big-number">{{ statsParaExibir.matchWinRate | number:'1.1-1' }}%</p>
        <div class="details">
          <span class="win">{{ statsParaExibir.matchWins }} V</span> - 
          <span class="loss">{{ statsParaExibir.matchLosses }} D</span>
        </div>
        <p class="sub-label">Total Matches: {{ statsParaExibir.totalMatches }}</p>
      </div>

      <div class="stat-card secondary">
        <h3>Game Win Rate</h3>
        <p class="big-number">{{ statsParaExibir.gameWinRate | number:'1.1-1' }}%</p>
        <div class="details">
          <span class="win">{{ statsParaExibir.gameWins }} V</span> - 
          <span class="loss">{{ statsParaExibir.gameLosses }} D</span>
        </div>
        <p class="sub-label">Total Games: {{ statsParaExibir.totalGames }}</p>
      </div>
    </div>

    <div class="toggle-container">
      <button (click)="alternarDecklist()" class="btn-toggle">
        {{ mostrarDecklist ? 'Ocultar Decklist' : 'Ver Decklist' }} üìã
      </button>
    </div>

    <div class="deck-list-container" *ngIf="mostrarDecklist">
      <div class="deck-column">
        <h3>Main Deck ({{ totalMainDeck }})</h3>
        <ul>
          <li *ngFor="let carta of mainDeck" 
              (mouseenter)="mostrarCarta(carta.nome)" 
              (mouseleave)="esconderCarta()">
            <span class="qtd">{{ carta.qtd }}</span>
            <span class="nome">{{ carta.nome }}</span>
          </li>
        </ul>
      </div>

      <div class="deck-column side" *ngIf="sideboard.length > 0">
        <h3>Sideboard ({{ totalSideboard }})</h3>
        <ul>
          <li *ngFor="let carta of sideboard"
              (mouseenter)="mostrarCarta(carta.nome)" 
              (mouseleave)="esconderCarta()">
            <span class="qtd">{{ carta.qtd }}</span>
            <span class="nome">{{ carta.nome }}</span>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <div class="card-preview" *ngIf="imagemDestaque">
    <img [src]="imagemDestaque" alt="Imagem da carta" class="imagem-carta-flutuante">
  </div>
</div>
